function ImageUpload(e,t){function n(e){var t=e.name,n=0,i=e.files.length,a=new FormData;i>1&&(t+="[]"),this.append=function(e){o(e)?(a.append(t,e,e.name),++n):--i},this.full=function(){return i>0&&n===i},this.get=function(){return a}}function i(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}function a(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var n=e.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(t.length),a=0;a<t.length;a++)i[a]=t.charCodeAt(a);return new Blob([i],{type:n})}function r(e){return m.fileTypes&&!m.fileTypes.test(e.type)?(f="Sorry, "+e.name+" is invalid, allowed extensions",!1):!0}function o(e){return"number"==typeof m.maxFileSize&&e.size>m.maxFileSize?(f="The file "+e.name+" must be less than "+m.maxFileSize/1024/1024+"MB",!1):!0}function s(t){u.append(t),u.full()&&(xhr=new XMLHttpRequest,xhr.open("POST",e.action,!0),xhr.onload=function(e){200==this.status&&alert(this.responseText)},xhr.send(u.get()))}function l(e){var t=new Image,n=new FileReader;t.onload=function(){if(0==t.width||0==t.height)return!1;var n=t.width,i=t.height,r=!1,o=e;if(n>i?n>m.imageMaxWidth&&(i*=m.imageMaxWidth/n,n=m.imageMaxWidth,r=!0):i>m.imageMaxHeight&&(n*=m.imageMaxHeight/i,i=m.imageMaxHeight,r=!0),r){var l=document.createElement("canvas");l.width=n,l.height=i;var u=l.getContext("2d");u.drawImage(t,0,0,n,i);var g=l.toDataURL(e.type),o=a(g);o.lastModifiedDate=e.lastModifiedDate,o.name=e.name}s(o)},n.onload=function(e){t.src=e.target.result},n.readAsDataURL(e)}if(!("FormData"in window&&"FileReader"in window&&"Blob"in window&&"XMLHttpRequest"in window&&"Image"in window))return alert("Not support features"),!1;var u,g={fileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,maxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,disableImageResize:!1},f="",m=i({},g,t);e.onsubmit=function(){for(var t=e.querySelectorAll("input[type='file']"),i=0;i<t.length;i++){u=new n(t[i]);for(var a=0;a<t[i].files.length;a++){var o=t[i].files[a];if(!r(o))return alert(f),t[i].value="",!1;m.disableImageResize?s(o):l(o)}}return!1}}
